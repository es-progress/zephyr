#!/usr/bin/env bash
###############
## ES-Ubuntu ##
##           ##
## Services  ##
## PHP       ##
###############

# PHP version
version="7.4"

# Strict mode
set -euo pipefail
IFS=$'\n\t'

source "${DIR_ESUBUNTU}/bootstrap.sh"
check-not-root || exit 1

print-status "Config PHP..."
sudo cp "${ES_CUSTOMIZE_CFG}/services/php/php.ini" "/etc/php/${version}/mods-available/php.ini"
[[ -e "/etc/php/${version}/fpm/conf.d/99-esubuntu.ini" ]] || sudo ln -s "/etc/php/${version}/mods-available/php.ini" "/etc/php/${version}/fpm/conf.d/99-esubuntu.ini"
[[ -e "/etc/php/${version}/cli/conf.d/99-esubuntu.ini" ]] || sudo ln -s "/etc/php/${version}/mods-available/php.ini" "/etc/php/${version}/cli/conf.d/99-esubuntu.ini"
sudo cp "${ES_CUSTOMIZE_CFG}/services/php/xdebug.ini" "/etc/php/${version}/mods-available/xdebug.ini"
print-finish

print-header "Restart services..."
sudo systemctl enable "php${version}-fpm.service"
sudo systemctl restart "php${version}-fpm.service"
sudo a2enconf "php${version}-fpm"
sudo systemctl restart apache2.service
print-finish

exit 0
