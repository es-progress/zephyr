#!/usr/bin/env bash
###############
## ES-Ubuntu ##
##           ##
## Config    ##
## Bash      ##
###############

# Strict mode
set -eufo pipefail
IFS=$'\n\t'

source "${PROJECT_ROOT}/bootstrap.sh"
check-not-root || exit 1

profile="${1:?"Profile missing"}"

shopt -s dotglob

if dir=$(cfg-get "${profile}" shell/bash/global.d); then
    print-status "Copy Bash files [global]..."
    find -L "${dir}" -mindepth 1 -maxdepth 1 -exec sudo cp -r --no-preserve=mode,ownership {} /root/ \;
    find -L "${dir}" -mindepth 1 -maxdepth 1 -exec sudo cp -r --no-preserve=mode,ownership {} /etc/skel/ \;
    find -L "${dir}" -mindepth 1 -maxdepth 1 -exec cp -r --no-preserve=mode,ownership {} ~/ \;
    print-finish
fi

if dir=$(cfg-get "${profile}" shell/bash/root.d); then
    print-status "Copy Bash files [root]..."
    find -L "${dir}" -mindepth 1 -maxdepth 1 -exec sudo cp -r --no-preserve=mode,ownership {} /root/ \;
    print-finish
fi

if dir=$(cfg-get "${profile}" shell/bash/local.d); then
    print-status "Copy Bash files [local]..."
    find -L "${dir}" -mindepth 1 -maxdepth 1 -exec cp -r --no-preserve=mode,ownership {} ~/ \;
    print-finish
fi

if [[ -e ~/.bash_history ]]; then
    print-status "Remove Bash history..."
    rm ~/.bash_history
    print-finish
fi

exit 0
