#!/usr/bin/env bash
###############
## ES-Ubuntu ##
##           ##
## Config    ##
## Scripts   ##
###############

# Strict mode
set -euo pipefail
IFS=$'\n\t'

source "${PROJECT_ROOT}/bootstrap.sh"
check-not-root || exit 1

print-status "Copy global shell scripts..."
sudo mkdir -p "${GLOBAL_BIN}"
files=$(find "${ES_CUSTOMIZE_FILES}/shell/bin" -type f)
for file in ${files}; do
    file_name=$(basename "${file}")
    sudo cp "${file}" "${GLOBAL_BIN}"
    sudo chown root:root "${GLOBAL_BIN}/${file_name}"
    sudo chmod =0755 "${GLOBAL_BIN}/${file_name}"
done
print-finish

print-status "Copy global shell library..."
sudo mkdir -p "${GLOBAL_LIB}"
files=$(find "${ES_CUSTOMIZE_FILES}/shell/lib" -type f)
for file in ${files}; do
    file_name=$(basename "${file}")
    sudo cp "${file}" "${GLOBAL_LIB}"
    sudo chown root:root "${GLOBAL_LIB}/${file_name}"
    sudo chmod =0644 "${GLOBAL_LIB}/${file_name}"
done
print-finish

if [[ -d "${ES_CFG_LOCAL}/files/shell" ]]; then
    print-status "Copy local shell scripts..."
    mkdir -p "${LOCAL_BIN}"
    files=$(find "${ES_CFG_LOCAL}/files/shell" -mindepth 1 -maxdepth 1)
    for file in ${files}; do
        cp -a "${file}" "${LOCAL_BIN}"
    done
    print-finish
fi

print-status "Link esubuntuctl..."
[[ -e "${LOCAL_BIN}/esubuntuctl" ]] || ln -s "${PROJECT_ROOT}/esubuntuctl" "${LOCAL_BIN}/esubuntuctl"
print-finish

exit 0
