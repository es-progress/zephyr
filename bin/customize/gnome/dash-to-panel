#!/usr/bin/env bash
###################
## ES-Ubuntu     ##
##               ##
## Config        ##
## GNOME         ##
## Dash-to-panel ##
###################

# Dash-to-panel version
version="v42"

# Strict mode
set -euo pipefail
IFS=$'\n\t'

source "${DIR_ESUBUNTU}/bootstrap.sh"
check-not-root || exit 1

print-header "Install Dash-to-panel..."
# Create temp dir
install_dir=$(mktemp -d)
# Get source
git clone "https://github.com/home-sweet-gnome/dash-to-panel.git" "${install_dir}"
git -C "${install_dir}" checkout "${version}"
# Install
make -C "${install_dir}" install
gnome-extensions enable "dash-to-panel@jderose9.github.com"
# Restart GNOME
busctl --user call "org.gnome.Shell" "/org/gnome/Shell" "org.gnome.Shell" "Eval" "s" 'Meta.restart("Restartingâ€¦")'
print-finish

print-status "Config Dash-to-panel.."
sed -e '/^#/d' -e '/^$/d' "${ES_CUSTOMIZE_CFG}/gnome/dash-to-panel" | dconf load /org/gnome/shell/extensions/
print-finish

exit 0
