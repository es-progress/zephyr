#!/usr/bin/env bash
###############
## ES-Ubuntu ##
##           ##
## Packages  ##
## apt       ##
###############

# Strict mode minus IFS
set -euo pipefail

# Bootstrap
source "${ESUBUNTU_HOME}/bootstrap.sh"

# Check if not run as root
check-not-root || exit 1

# Read packages
repos=()
packages=()
apt_packages=$(read-file-cfg "${CUSTOMIZE_CFG_DIR}/packages/apt")
while read -r package repo; do
    [[ -n "${repo}" ]] && repos+=("${repo}")
    packages+=("${package}")
done <<< "${apt_packages}"

for repo in "${repos[@]}"; do
    print-header "Adding apt repo: ${repo}..."
    sudo add-apt-repository --yes --no-update "${repo}"
    print-finish
done

print-header "Update apt cache..."
sudo apt update
print-finish

print-header "Installing packages..."
sudo apt install --yes "${packages[@]}"
print-finish

exit 0
