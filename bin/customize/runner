#!/usr/bin/env bash
####################
## ES-Ubuntu      ##
##                ##
## Runner         ##
## Customizations ##
####################

# Dirs to run (Name;Path)
exec_dir=(
    "Initialize;init"
    "Install packages;packages"
    "Install services;services"
    "Setup shell;shell"
    "Config tools;tools"
    "Config apps;apps"
    "Config GNOME;gnome"
    "Random configs;random"
)

# Strict mode
set -euo pipefail
IFS=$'\n\t'

source "${PROJECT_ROOT}/bootstrap.sh"

# Parse options
filter=()
[[ -n "${1:-}" ]] && filter=("--regex=^${1}\$")

for item in "${exec_dir[@]}"; do
    IFS=";" read -r name dir <<<"${item}"
    runnable=$(run-parts --test "${filter[@]}" "${ES_CUSTOMIZE_SCRIPTS}/${dir}")
    if [[ -n "$runnable" ]]; then
        print-section "${name}"
        run-parts --exit-on-error "${filter[@]}" "${ES_CUSTOMIZE_SCRIPTS}/${dir}"
    fi
done

exit 0
