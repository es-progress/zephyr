#!/usr/bin/env bash
####################
## ES-Ubuntu      ##
##                ##
## Runner         ##
## Customizations ##
####################

# Dirs to run (Name;Path)
exec_dir=(
    "Initialize;init"
    "Install packages;packages"
    "Install other packages;packages/misc"
    "Install services;services"
    "Setup shell;shell"
    "Config tools;tools"
    "Config apps;apps"
    "Config GNOME;gnome"
    "Random configs;random"
)

# Strict mode minus IFS
set -euo pipefail

source "${ESUBUNTU_HOME}/bootstrap.sh"

# Parse options
filter="${1:-}"

# run-parts options
run_parts_test="--test --regex=${filter}"
run_parts_exec="--exit-on-error --regex=${filter}"

for item in "${exec_dir[@]}"; do
    IFS=";" read -r name dir <<<"${item}"
    runnable=$(run-parts ${run_parts_test} "${ES_SCRIPTS_CUSTOMIZE}/${dir}")
    if [[ -n "$runnable" ]]; then
        print-section "${name}"
        run-parts ${run_parts_exec} "${ES_SCRIPTS_CUSTOMIZE}/${dir}"
    fi
done

exit 0
